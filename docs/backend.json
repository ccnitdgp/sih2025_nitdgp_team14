
{
  "entities": {
    "DoctorProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "DoctorProfile",
      "type": "object",
      "description": "Represents a doctor's public profile.",
      "properties": {
        "id": { "type": "string" },
        "firstName": { "type": "string" },
        "lastName": { "type": "string" },
        "specialty": { "type": "string" },
        "city": { "type": "string" },
        "state": { "type": "string" },
        "country": { "type": "string" }
      },
      "required": ["id", "firstName", "lastName", "specialty"]
    },
    "PatientLink": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PatientLink",
      "type": "object",
      "description": "Represents a link to a patient in a doctor's patient list.",
      "properties": {
        "patientId": {
          "type": "string",
          "description": "The UID of the linked patient."
        },
        "firstName": {
          "type": "string"
        },
        "lastName": {
          "type": "string"
        },
        "email": {
          "type": "string",
          "format": "email"
        }
      },
      "required": ["patientId", "firstName", "lastName", "email"]
    },
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user profile in the Swasthya application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserProfile entity."
        },
        "doctorId": {
          "type": "string",
          "description": "The UID of the assigned doctor (for patients)."
        },
        "firstName": {
          "type": "string",
          "description": "First name of the user."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the user."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "dateOfBirth": {
          "type": "string",
          "description": "Date of birth of the user.",
          "format": "date"
        },
        "gender": {
          "type": "string",
          "description": "Gender of the user."
        },
        "phoneNumber": {
          "type": "string",
          "description": "Phone number of the user."
        },
        "role": {
          "type": "string",
          "description": "Role of the user within the application.",
          "enum": ["patient", "doctor", "admin"]
        },
        "preferredLanguage": {
          "type": "string",
          "description": "Preferred language of the user."
        },
        "healthRecordIds": {
          "type": "array",
          "description": "References to HealthRecords. (Relationship: UserProfile 1:N HealthRecord)",
          "items": {
            "type": "string"
          }
        },
        "bloodGroup": {
            "type": "string",
            "description": "User's blood group.",
            "enum": ["A+", "A-", "B+", "B-", "AB+", "AB-", "O+", "O-"]
        },
        "address": {
            "type": "object",
            "description": "User's full address and location information.",
            "properties": {
                "fullAddress": {"type": "string"},
                "city": {"type": "string"},
                "state": {"type": "string"},
                "country": {"type": "string"},
                "pinCode": {"type": "string"},
                "geolocation": {
                    "type": "object",
                    "properties": {
                        "lat": {"type": "number"},
                        "lon": {"type": "number"}
                    }
                }
            },
            "required": ["fullAddress", "city", "state", "country", "pinCode"]
        },
        "emergencyContact": {
            "type": "object",
            "description": "User's emergency contact information.",
            "properties": {
                "name": {"type": "string"},
                "phone": {"type": "string"},
                "relation": {"type": "string"}
            },
            "required": ["name", "phone", "relation"]
        },
        "dateFormat": {
          "type": "string",
          "description": "User's preferred date format."
        },
        "notificationSettings": {
            "type": "object",
            "description": "User's notification preferences.",
            "properties": {
                "appointmentReminders": {"type": "boolean"},
                "prescriptionReminders": {"type": "boolean"},
                "vaccinationReminders": {"type": "boolean"},
                "healthTips": {"type": "boolean"},
                "email": {"type": "boolean"},
                "sms": {"type": "boolean"},
                "push": {"type": "boolean"}
            }
        },
        "healthMetrics": {
            "type": "object",
            "description": "User's key health metrics.",
            "properties": {
                "height": { "type": "number", "description": "Height in centimeters." },
                "weight": { "type": "number", "description": "Weight in kilograms." },
                "bloodPressure": { "type": "string", "description": "Most recent blood pressure reading (e.g., '120/80')." },
                "bloodSugar": { "type": "number", "description": "Most recent blood sugar level in mg/dL." },
                "pulseRate": { "type": "number", "description": "Most recent resting pulse rate in bpm." }
            }
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email",
        "dateOfBirth",
        "phoneNumber",
        "role"
      ]
    },
    "VaccinationDrive": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "VaccinationDrive",
      "type": "object",
      "description": "Represents a vaccination drive event.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the VaccinationDrive entity."
        },
        "location": {
          "type": "string",
          "description": "Location of the vaccination drive."
        },
        "schedule": {
          "type": "string",
          "description": "Schedule of the vaccination drive (e.g., date and time).",
          "format": "date-time"
        },
        "vaccineType": {
          "type": "string",
          "description": "Type of vaccine offered at the drive."
        },
        "description": {
          "type": "string",
          "description": "A description of the vaccination drive."
        }
      },
      "required": [
        "id",
        "location",
        "schedule",
        "vaccineType"
      ]
    },
    "HealthCamp": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "HealthCamp",
      "type": "object",
      "description": "Represents a health camp event.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the HealthCamp entity."
        },
        "location": {
          "type": "string",
          "description": "Location of the health camp."
        },
        "startTime": {
          "type": "string",
          "description": "Starting time of the health camp.",
          "format": "date-time"
        },
        "endTime": {
          "type": "string",
          "description": "Ending time of the health camp.",
          "format": "date-time"
        },
        "availableServices": {
          "type": "string",
          "description": "Details of available services at the health camp."
        },
        "description": {
          "type": "string",
          "description": "A description of the health camp."
        }
      },
      "required": [
        "id",
        "location",
        "startTime",
        "endTime",
        "availableServices"
      ]
    },
    "MedicalNotification": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "MedicalNotification",
      "type": "object",
      "description": "Represents a medical notification sent to users.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the MedicalNotification entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N MedicalNotification)"
        },
        "message": {
          "type": "string",
          "description": "The content of the medical notification."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of when the notification was sent.",
          "format": "date-time"
        },
        "type": {
          "type": "string",
          "description": "Type of medical notification (e.g., appointment reminder, medication alert)."
        }
      },
      "required": [
        "id",
        "userId",
        "message",
        "timestamp",
        "type"
      ]
    },
    "HealthRecord": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "HealthRecord",
      "type": "object",
      "description": "Represents a user's health record.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the HealthRecord entity."
        },
        "recordType": {
          "type": "string",
          "description": "Type of health record (e.g., vaccination record, medical history)."
        },
        "details": {
          "type": "string",
          "description": "Detailed information contained within the health record."
        },
        "dateCreated": {
          "type": "string",
          "description": "Date when the health record was created.",
          "format": "date-time"
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N HealthRecord)"
        }
      },
      "required": [
        "id",
        "recordType",
        "details",
        "dateCreated",
        "userId"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores private user profile information for both patients and doctors. Path-based ownership ensures only the authenticated user can access their profile.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/doctors/{doctorId}",
        "definition": {
            "entityName": "DoctorProfile",
            "schema": { "$ref": "#/backend/entities/DoctorProfile" },
            "description": "A public collection storing information about doctors that is safe for any user to read (e.g., for finding a doctor).",
            "params": [{ "name": "doctorId", "description": "The UID of the doctor, which should match their UID in the /users collection." }]
        }
      },
      {
        "path": "/users/{doctorId}/patients/{patientId}",
        "definition": {
          "entityName": "PatientLink",
          "schema": { "$ref": "#/backend/entities/PatientLink" },
          "description": "A subcollection within a doctor's user document that links them to their patients. This is used for authorization checks.",
          "params": [
            { "name": "doctorId", "description": "The UID of the doctor." },
            { "name": "patientId", "description": "The UID of the patient." }
          ]
        }
      },
      {
        "path": "/users/{userId}/healthRecords/{healthRecordId}",
        "definition": {
          "entityName": "HealthRecord",
          "schema": {
            "$ref": "#/backend/entities/HealthRecord"
          },
          "description": "Stores user's health records. Path-based ownership ensures only the authenticated user or their assigned doctor can access them.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "healthRecordId",
              "description": "The unique identifier of the health record."
            }
          ]
        }
      },
      {
        "path": "/vaccinationDrives/{vaccinationDriveId}",
        "definition": {
          "entityName": "VaccinationDrive",
          "schema": {
            "$ref": "#/backend/entities/VaccinationDrive"
          },
          "description": "Stores information about vaccination drives. This is a public collection.",
          "params": [
            {
              "name": "vaccinationDriveId",
              "description": "The unique identifier of the vaccination drive."
            }
          ]
        }
      },
      {
        "path": "/healthCamps/{healthCampId}",
        "definition": {
          "entityName": "HealthCamp",
          "schema": {
            "$ref": "#/backend/entities/HealthCamp"
          },
          "description": "Stores information about health camps. This is a public collection.",
          "params": [
            {
              "name": "healthCampId",
              "description": "The unique identifier of the health camp."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/notifications/{notificationId}",
        "definition": {
          "entityName": "MedicalNotification",
          "schema": {
            "$ref": "#/backend/entities/MedicalNotification"
          },
          "description": "Stores medical notifications for users. Path-based ownership ensures only the authenticated user can access their notifications.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "notificationId",
              "description": "The unique identifier of the medical notification."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure has been redesigned for clarity and security. The core change is the introduction of a public `/doctors` collection, which is separate from the private `/users` collection. The `/doctors` collection stores only non-sensitive information necessary for patients to find and view doctor profiles. The `/users` collection holds all private data for both patients and doctors, strictly secured by user UID. This separation prevents permission errors when listing doctors and adheres to security best practices by not exposing the entire user base."
  }
}

    